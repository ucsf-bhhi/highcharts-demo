---
title: "Data Viz Demo"
author: "Sara Colom"
date: "`r Sys.Date()`"
output:
  html_document:
    df_print: kable
    code_folding: hide
---

Prepare demo plots for BHHI webpage. 

Download data from `Y:\Research\BHHI\Statewide Survey\state_survey_benchmarking\data`

```{r, message = F, warning = F}
# Read in data & libraries
library(tidyverse)
library(stringr)
library(highcharter)
library(bhhi.doc)

# Read in weighted state survey data
dat_w <- read_rds("../../state_survey_benchmarking/data/clean_dat_final.rds")

state <- read_rds("../../state_survey_benchmarking/data/state_cleaned.rds")

source("aesthetics.R")
```



# Scatter plot

```{r}
airquality %>% 
  hchart(., 
         type = "scatter", 
         color = bhhi_palette("yellow", names = FALSE),
         hcaes(x = Month, 
               y = Temp))
```

# Bar graph

```{r}
dat_w %>% 
  filter(variable == "sheltered") %>% 
    hchart(., 
         type = "bar", 
         color = bhhi_palette("yellow", names = FALSE),
         hcaes(x = county, 
               y = freq),
         name = "Frequency") %>% 
           hc_xAxis(
           title = ""
         ) %>% 
  hc_yAxis(
    title = list(text = "Frequency")
  ) %>% 
  hc_title(
    text = "Frequency of Sheltered by County"
  ) %>% 
  hc_caption(text = "Weighted frequencies are shown.")
```

# Grouped bar graph

```{r}


state %>%
  filter(!is.na(veteran_status)) %>% 
  group_by(county, veteran_status) %>% 
  summarise(n = n(),
            .groups = "keep") %>% 
  ungroup() %>% 
  mutate(colors = case_when(veteran_status == 1 ~ bhhi_palette("blue"),
                            veteran_status == 0 ~ bhhi_palette("yellow"))) %>% 
    hchart(., 
         type = "bar",
         hcaes(x = county, 
               y = n,
               group = veteran_status,
               color = colors),
         name = "Veteran status",
         showInLegend = F) %>% 
           hc_xAxis(
           title = ""
         ) %>% 
  hc_add_series(name = "Veteran", color = bhhi_palette("blue"), marker = list(symbol = "point")) %>% 
  hc_add_series(name = "Not veteran", color = bhhi_palette("yellow"), marker = list(symbol = "point")) %>% 
  hc_yAxis(
    title = list(text = "Frequency")
  ) %>% 
  hc_title(
    text = "Count of Veteran Status by County"
  ) %>% 
  hc_caption(text = "Unweighted counts are shown.")
```


# Histogram

```{r}
hchart(state$age_self_report,
       type = "histogram",
       color = bhhi_palette("blue"),
       name = "age") %>% 
  hc_title(text = "State Survey Age Distribution") %>% 
  hc_yAxis(title = list(text = "Frequency")) %>% 
  hc_xAxis(title = list(text = "Age")) %>% 
  hc_caption(text = "Unweighted data is shown.")
```

